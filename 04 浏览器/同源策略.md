## 同源策略定义

浏览器的安全策略，预防XSS、CSFR攻击。

具体表现为：浏览器在执行脚本前，会判断脚本是否与打开的网页是同源的（协议、域名、端口均相同及为同源，其中有一项不相同及为跨域，报CORS异常）。

目的是为了保护本地数据不被JavaScript代码获取回来的数据污染，请求发起，服务器响应了，但是跨域的情况下无法被浏览器接收。

## 为什么拦截的是响应不是请求？

可以理解为服务端也可以决定是否同意跨域，比如开启CORS跨域

## 同源策略分类

DOM 同源策略：禁止对不同源页面 DOM 进行操作。比如嵌套了第三方iframe，防止恶意网站              								 操作DOM

XMLHttpRequest 同源策略 ：禁止使用XHR对象向不同源服务器地址发起HTTP请求，比如															ajax

存储性内容同源策略： js中无法访问不属于同个源的cookie、LocalStorage中存储的内容。

p.s 具体来说，cookie和LocalStorage在控制哪些源可以访问的问题上有细微差别，父域在设置cookie的时候可以设定允许子域访问这段cookie，同时Cookie只和域名以及路径关联，如果是同个域名不同端口的源依然是共享同个域名下的Cookie的，而LocalStorage则是以源为单位进行管理，相互独立，不同源之间无法相互访问LocalStorage中的内容。

## 同源策略留的“后门”

1. 页面中的链接，重定向以及表单提交是不会受到同源策略限制的(**未授权情况下，ajax 的表单提交是不被允许的,但是普通的表单是可以直接跨域的**)。
2. `<script>、<img>、<link>`这些包含 src 属性的标签可以加载跨域资源。

## 小结

同源策略控制不同源之间的交互，这些交互通常分为三类：
**(1)跨域读：** 同源策略是不允许这种事情发生的，如果可以你就能使用 js 读取嵌入在 iframe 中的页面的 dom 元素，获取敏感信息了

**(2)跨域写：** 同源策略不阻止这种操作，比如向不同源的地址发送 POST 请求等，但是这种允许只限制在普通表单（而且是在没有 CSRF token 或者验证 referer 的情况下），对于 ajax 这种方式也是默认不允许的，如果随随便便允许就会出现使用 ajax 来进行 CSRF 请求的情况了

**(3)跨域嵌入：** 这种方式是默认允许的，我们可以在一个源中通过 iframe 嵌入 另一个源的页面，但是如果想限制这种操作的话，我们可以设置 x-frame-options 这个头，这样设置了这个头的页面就允许被嵌入到不同源的页面中了